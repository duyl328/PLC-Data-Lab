<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šç”¨PLCæ•°æ®è½¬æ¢å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: auto;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .panel h3 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button.secondary {
            background: linear-gradient(45deg, #718096, #2d3748);
        }

        button.success {
            background: linear-gradient(45deg, #48bb78, #38a169);
        }

        button.warning {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
        }

        .result-panel {
            grid-column: 1 / -1;
        }

        .result {
            background: linear-gradient(135deg, #f0fff4, #e6fffa);
            border: 2px solid #48bb78;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .error {
            background: linear-gradient(135deg, #fed7d7, #ffeaea);
            border-color: #f56565;
            color: #c53030;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            background: #f7fafc;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .preset-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .preset-card:hover {
            border-color: #667eea;
            background: #eef2ff;
            transform: translateY(-2px);
        }

        .preset-card.active {
            border-color: #667eea;
            background: #eef2ff;
        }

        .preset-card h4 {
            color: #4a5568;
            margin-bottom: 5px;
        }

        .preset-card p {
            color: #718096;
            font-size: 12px;
        }

        .format-examples {
            background: #fafafa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border-left: 4px solid #667eea;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .bit-display {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin: 10px 0;
        }

        .bit {
            background: #f1f5f9;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            padding: 8px 4px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bit.set {
            background: #48bb78;
            color: white;
        }

        .floating-help {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .help-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .help-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ é€šç”¨PLCæ•°æ®è½¬æ¢å·¥å…·</h1>
            <p>æ”¯æŒæ‰€æœ‰ä¸»æµPLCå“ç‰Œå’Œæ•°æ®æ ¼å¼çš„ä¸“ä¸šè½¬æ¢å·¥å…·</p>
        </div>

        <div class="main-grid">
            <!-- å·¦ä¾§ï¼šé…ç½®é¢æ¿ -->
            <div class="panel">
                <h3><span class="icon">âš™ï¸</span>è½¬æ¢é…ç½®</h3>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('basic')">åŸºç¡€è½¬æ¢</div>
                    <div class="tab" onclick="switchTab('advanced')">é«˜çº§é€‰é¡¹</div>
                    <div class="tab" onclick="switchTab('presets')">é¢„è®¾é…ç½®</div>
                </div>

                <!-- åŸºç¡€è½¬æ¢ -->
                <div id="basic" class="tab-content active">
                    <div class="form-group">
                        <label>PLCå“ç‰Œ</label>
                        <select id="plcBrand" onchange="updatePresets()">
                            <option value="omron">æ¬§å§†é¾™ (Omron)</option>
                            <option value="siemens">è¥¿é—¨å­ (Siemens)</option>
                            <option value="mitsubishi">ä¸‰è± (Mitsubishi)</option>
                            <option value="ab">ç½—å…‹éŸ¦å°” (Allen-Bradley)</option>
                            <option value="schneider">æ–½è€å¾· (Schneider)</option>
                            <option value="delta">å°è¾¾ (Delta)</option>
                            <option value="keyence">åŸºæ©å£« (Keyence)</option>
                            <option value="panasonic">æ¾ä¸‹ (Panasonic)</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label>æºæ•°æ®ç±»å‹</label>
                            <select id="sourceType">
                                <option value="ushort">USHORT (16ä½)</option>
                                <option value="short">SHORT (16ä½)</option>
                                <option value="uint">UINT (32ä½)</option>
                                <option value="int">INT (32ä½)</option>
                                <option value="ulong">ULONG (64ä½)</option>
                                <option value="long">LONG (64ä½)</option>
                                <option value="byte">BYTE (8ä½)</option>
                                <option value="bool">BOOL (1ä½)</option>
                                <option value="real">REAL (32ä½æµ®ç‚¹)</option>
                                <option value="double">DOUBLE (64ä½æµ®ç‚¹)</option>
                                <option value="string">STRING</option>
                                <option value="raw">åŸå§‹æ•°æ®</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>ç›®æ ‡æ•°æ®ç±»å‹</label>
                            <select id="targetType">
                                <option value="int">INT (32ä½)</option>
                                <option value="uint">UINT (32ä½)</option>
                                <option value="short">SHORT (16ä½)</option>
                                <option value="ushort">USHORT (16ä½)</option>
                                <option value="long">LONG (64ä½)</option>
                                <option value="ulong">ULONG (64ä½)</option>
                                <option value="byte">BYTE (8ä½)</option>
                                <option value="bool">BOOL (1ä½)</option>
                                <option value="real">REAL (32ä½æµ®ç‚¹)</option>
                                <option value="double">DOUBLE (64ä½æµ®ç‚¹)</option>
                                <option value="string">STRING</option>
                                <option value="hex">åå…­è¿›åˆ¶</option>
                                <option value="binary">äºŒè¿›åˆ¶</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid-3">
                        <div class="form-group">
                            <label>å­—èŠ‚åº</label>
                            <select id="byteOrder">
                                <option value="ABCD">ABCD (å¤§ç«¯åº)</option>
                                <option value="DCBA">DCBA (å°ç«¯åº)</option>
                                <option value="BADC">BADC (æ··åˆåº1)</option>
                                <option value="CDAB">CDAB (æ··åˆåº2)</option>
                                <option value="auto">è‡ªåŠ¨æ£€æµ‹</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>ä½åº</label>
                            <select id="bitOrder">
                                <option value="msb">MSBä¼˜å…ˆ</option>
                                <option value="lsb">LSBä¼˜å…ˆ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>æ•°æ®æ ¼å¼</label>
                            <select id="dataFormat">
                                <option value="decimal">åè¿›åˆ¶</option>
                                <option value="hex">åå…­è¿›åˆ¶</option>
                                <option value="binary">äºŒè¿›åˆ¶</option>
                                <option value="array">æ•°ç»„</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- é«˜çº§é€‰é¡¹ -->
                <div id="advanced" class="tab-content">
                    <div class="grid-2">
                        <div class="form-group">
                            <label>åç§»é‡ (å­—èŠ‚)</label>
                            <input type="number" id="offset" value="0" min="0">
                        </div>

                        <div class="form-group">
                            <label>æ•°æ®é•¿åº¦é™åˆ¶</label>
                            <input type="number" id="lengthLimit" value="0" min="0" placeholder="0=æ— é™åˆ¶">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="signedData" checked>
                            æœ‰ç¬¦å·æ•°æ®
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="reverseOrder">
                            åè½¬æ•°ç»„é¡ºåº
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ignoreErrors">
                            å¿½ç•¥è½¬æ¢é”™è¯¯
                        </label>
                    </div>

                    <div class="form-group">
                        <label>æµ®ç‚¹æ•°ç²¾åº¦</label>
                        <input type="number" id="precision" value="6" min="0" max="15">
                    </div>

                    <div class="form-group">
                        <label>å­—ç¬¦ä¸²ç¼–ç </label>
                        <select id="encoding">
                            <option value="utf8">UTF-8</option>
                            <option value="ascii">ASCII</option>
                            <option value="gbk">GBK</option>
                            <option value="unicode">Unicode</option>
                        </select>
                    </div>
                </div>

                <!-- é¢„è®¾é…ç½® -->
                <div id="presets" class="tab-content">
                    <div class="preset-grid" id="presetGrid">
                        <!-- é¢„è®¾é…ç½®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="button-group">
                        <button onclick="saveCurrentPreset()">ğŸ’¾ ä¿å­˜å½“å‰é…ç½®</button>
                        <button onclick="loadPreset()" class="secondary">ğŸ“ åŠ è½½é…ç½®æ–‡ä»¶</button>
                        <input type="file" id="fileInput" style="display:none" accept=".json">
                    </div>
                </div>

                <div class="button-group">
                    <button onclick="convertData()">ğŸ”„ è½¬æ¢æ•°æ®</button>
                    <button onclick="autoDetect()" class="warning">ğŸ” è‡ªåŠ¨æ£€æµ‹</button>
                    <button onclick="clearAll()" class="secondary">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
            </div>

            <!-- å³ä¾§ï¼šæ•°æ®è¾“å…¥é¢æ¿ -->
            <div class="panel">
                <h3><span class="icon">ğŸ“¥</span>æ•°æ®è¾“å…¥</h3>
                
                <div class="form-group">
                    <label>åŸå§‹æ•°æ®</label>
                    <textarea id="inputData" placeholder="è¾“å…¥ä½ çš„PLCæ•°æ®ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼š
[256,0,256,0,256,0]
256,0,256,0,256,0
0x0100,0x0000,0x0100
01000000 00000000...">[256,0,256,0,256,0,256,0,256,0]</textarea>
                </div>

                <div class="button-group">
                    <button onclick="loadSampleData()" class="secondary">ğŸ“ åŠ è½½ç¤ºä¾‹</button>
                    <button onclick="importFromFile()" class="secondary">ğŸ“‚ ä»æ–‡ä»¶å¯¼å…¥</button>
                    <button onclick="formatInput()">ğŸ¨ æ ¼å¼åŒ–</button>
                </div>

                <div class="format-examples">
                    <strong>æ”¯æŒçš„è¾“å…¥æ ¼å¼ï¼š</strong><br>
                    æ•°ç»„: [1,2,3] æˆ– 1,2,3<br>
                    åå…­è¿›åˆ¶: 0x01,0x02 æˆ– 01 02<br>
                    äºŒè¿›åˆ¶: 00000001 00000010<br>
                    æ··åˆ: 1 0x02 00000011
                </div>

                <!-- ä½ç¼–è¾‘å™¨ -->
                <div class="form-group">
                    <label>ä½ç¼–è¾‘å™¨ <small>(ç‚¹å‡»åˆ‡æ¢ä½çŠ¶æ€)</small></label>
                    <div id="bitEditor" class="bit-display">
                        <!-- ä½æ˜¾ç¤ºå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»“æœé¢æ¿ -->
        <div class="panel result-panel">
            <h3><span class="icon">ğŸ“¤</span>è½¬æ¢ç»“æœ</h3>
            
            <div class="button-group">
                <button onclick="exportResult()" class="success">ğŸ’¾ å¯¼å‡ºç»“æœ</button>
                <button onclick="copyToClipboard()" class="success">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
                <button onclick="showComparison()" class="secondary">ğŸ” æ˜¾ç¤ºå¯¹æ¯”</button>
            </div>

            <div id="result"></div>
        </div>
    </div>

    <!-- æµ®åŠ¨å¸®åŠ©æŒ‰é’® -->
    <div class="floating-help" onclick="toggleHelp()">â“</div>

    <!-- å¸®åŠ©é¢æ¿ -->
    <div class="help-panel" id="helpPanel" onclick="toggleHelp()">
        <div class="help-content" onclick="event.stopPropagation()">
            <h2>ğŸ“š ä½¿ç”¨å¸®åŠ©</h2>
            <h3>PLCå“ç‰Œç‰¹è‰²ï¼š</h3>
            <ul>
                <li><strong>æ¬§å§†é¾™:</strong> é€šå¸¸ä½¿ç”¨å°ç«¯åºï¼Œæ”¯æŒCJ/CP/CSç³»åˆ—</li>
                <li><strong>è¥¿é—¨å­:</strong> S7ç³»åˆ—ï¼Œå¤§ç«¯åºä¸ºä¸»</li>
                <li><strong>ä¸‰è±:</strong> FX/Qç³»åˆ—ï¼Œæ··åˆå­—èŠ‚åºå¸¸è§</li>
                <li><strong>AB:</strong> CompactLogix/ControlLogixï¼Œå°ç«¯åº</li>
                <li><strong>æ–½è€å¾·:</strong> Modiconç³»åˆ—ï¼Œå¤§ç«¯åº</li>
            </ul>
            
            <h3>æ•°æ®ç±»å‹è¯´æ˜ï¼š</h3>
            <ul>
                <li><strong>BOOL:</strong> 1ä½å¸ƒå°”å€¼</li>
                <li><strong>BYTE:</strong> 8ä½æ— ç¬¦å·æ•´æ•° (0-255)</li>
                <li><strong>USHORT:</strong> 16ä½æ— ç¬¦å·æ•´æ•° (0-65535)</li>
                <li><strong>INT:</strong> 32ä½æœ‰ç¬¦å·æ•´æ•°</li>
                <li><strong>REAL:</strong> 32ä½IEEE754æµ®ç‚¹æ•°</li>
            </ul>

            <h3>å­—èŠ‚åºè¯´æ˜ï¼š</h3>
            <ul>
                <li><strong>ABCD:</strong> å¤§ç«¯åºï¼Œé«˜å­—èŠ‚åœ¨å‰</li>
                <li><strong>DCBA:</strong> å°ç«¯åºï¼Œä½å­—èŠ‚åœ¨å‰</li>
                <li><strong>BADC/CDAB:</strong> å­—èŠ‚å¯¹è°ƒçš„æ··åˆæ¨¡å¼</li>
            </ul>

            <button onclick="toggleHelp()" style="margin-top: 20px;">å…³é—­å¸®åŠ©</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentPresets = {};
        let conversionHistory = [];

        // PLCå“ç‰Œé¢„è®¾é…ç½®
        const plcPresets = {
            omron: {
                name: "æ¬§å§†é¾™é»˜è®¤",
                byteOrder: "DCBA",
                bitOrder: "lsb",
                signed: true,
                description: "é€‚ç”¨äºCJ/CP/CSç³»åˆ—"
            },
            siemens: {
                name: "è¥¿é—¨å­é»˜è®¤", 
                byteOrder: "ABCD",
                bitOrder: "msb",
                signed: true,
                description: "é€‚ç”¨äºS7-300/400/1500"
            },
            mitsubishi: {
                name: "ä¸‰è±é»˜è®¤",
                byteOrder: "BADC", 
                bitOrder: "lsb",
                signed: true,
                description: "é€‚ç”¨äºFX/Qç³»åˆ—"
            },
            ab: {
                name: "ABé»˜è®¤",
                byteOrder: "DCBA",
                bitOrder: "lsb", 
                signed: true,
                description: "é€‚ç”¨äºCompactLogix"
            },
            schneider: {
                name: "æ–½è€å¾·é»˜è®¤",
                byteOrder: "ABCD",
                bitOrder: "msb",
                signed: true,
                description: "é€‚ç”¨äºModiconç³»åˆ—"
            }
        };

        // åˆå§‹åŒ–
        window.onload = function() {
            updatePresets();
            updateBitEditor();
            loadSampleData();
        };

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // æ›´æ–°é¢„è®¾é…ç½®
        function updatePresets() {
            const brand = document.getElementById('plcBrand').value;
            const presetGrid = document.getElementById('presetGrid');
            
            presetGrid.innerHTML = '';
            
            Object.entries(plcPresets).forEach(([key, preset]) => {
                const card = document.createElement('div');
                card.className = 'preset-card';
                if (key === brand) card.classList.add('active');
                
                card.innerHTML = `
                    <h4>${preset.name}</h4>
                    <p>${preset.description}</p>
                `;
                
                card.onclick = () => applyPreset(key);
                presetGrid.appendChild(card);
            });
        }

        // åº”ç”¨é¢„è®¾é…ç½®
        function applyPreset(presetKey) {
            const preset = plcPresets[presetKey];
            if (!preset) return;
            
            document.getElementById('byteOrder').value = preset.byteOrder;
            document.getElementById('bitOrder').value = preset.bitOrder;
            document.getElementById('signedData').checked = preset.signed;
            document.getElementById('plcBrand').value = presetKey;
            
            updatePresets();
        }

        // åŠ è½½ç¤ºä¾‹æ•°æ®
        function loadSampleData() {
            const samples = [
                "[256,0,256,0,256,0,256,0,256,0]",
                "0x0100,0x0000,0x0100,0x0000",
                "1,0,1,0,1,0,1,0,1,0",
                "00000001 00000000 00000001 00000000"
            ];
            
            const randomSample = samples[Math.floor(Math.random() * samples.length)];
            document.getElementById('inputData').value = randomSample;
        }

        // è§£æè¾“å…¥æ•°æ®
        function parseInputData(input) {
            input = input.trim();
            
            // ç§»é™¤æ•°ç»„æ‹¬å·
            if (input.startsWith('[') && input.endsWith(']')) {
                input = input.slice(1, -1);
            }
            
            // åˆ†å‰²æ•°æ®
            let values = [];
            
            if (input.includes(',')) {
                values = input.split(',');
            } else {
                values = input.split(/\s+/);
            }
            
            // è§£ææ¯ä¸ªå€¼
            return values.map(val => {
                val = val.trim();
                if (val.startsWith('0x') || val.startsWith('0X')) {
                    return parseInt(val, 16);
                } else if (/^[01]+$/.test(val) && val.length > 4) {
                    return parseInt(val, 2);
                } else {
                    return parseInt(val, 10);
                }
            }).filter(val => !isNaN(val));
        }

        // ä¸»è¦è½¬æ¢å‡½æ•°
        function convertData() {
            const inputData = document.getElementById('inputData').value;
            const sourceType = document.getElementById('sourceType').value;
            const targetType = document.getElementById('targetType').value;
            const byteOrder = document.getElementById('byteOrder').value;
            const signed = document.getElementById('signedData').checked;
            const resultDiv = document.getElementById('result');

            try {
                const parsedData = parseInputData(inputData);
                if (parsedData.length === 0) {
                    throw new Error('æ— æ³•è§£æè¾“å…¥æ•°æ®');
                }

                let result;
                
                // æ ¹æ®è½¬æ¢ç±»å‹è¿›è¡Œå¤„ç†
                if (sourceType === 'ushort' && targetType === 'int') {
                    result = convertUshortToInt(parsedData, byteOrder, signed);
                } else if (sourceType === 'int' && targetType === 'ushort') {
                    result = convertIntToUshort(parsedData, byteOrder);
                } else if (targetType === 'real') {
                    result = convertToFloat(parsedData, byteOrder);
                } else if (targetType === 'double') {
                    result = convertToDouble(parsedData, byteOrder);
                } else if (targetType === 'hex') {
                    result = convertToHex(parsedData);
                } else if (targetType === 'binary') {
                    result = convertToBinary(parsedData);
                } else if (targetType === 'bool') {
                    result = convertToBool(parsedData);
                } else {
                    result = convertGeneric(parsedData, sourceType, targetType, byteOrder, signed);
                }

                displayResult(result, parsedData, sourceType, targetType, byteOrder);
                updateBitEditor(parsedData[0] || 0);
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">è½¬æ¢é”™è¯¯: ${error.message}</div>`;
            }
        }

        // è½¬æ¢å‡½æ•°å®ç°
        function convertUshortToInt(ushortArray, byteOrder, signed = true) {
            if (ushortArray.length % 2 !== 0) {
                throw new Error('USHORTåˆ°INTè½¬æ¢éœ€è¦å¶æ•°ä¸ªæ•°æ®');
            }
            
            const intArray = [];
            
            for (let i = 0; i < ushortArray.length; i += 2) {
                const low = ushortArray[i];
                const high = ushortArray[i + 1];
                
                let intValue;
                switch (byteOrder) {
                    case 'ABCD':
                        intValue = (high << 16) | low;
                        break;
                    case 'DCBA':
                        intValue = (low << 16) | high;
                        break;
                    case 'BADC':
                        intValue = ((low & 0xFF) << 24) | (((low >> 8) & 0xFF) << 16) | 
                                  ((high & 0xFF) << 8) | ((high >> 8) & 0xFF);
                        break;
                    case 'CDAB':
                        intValue = ((high & 0xFF) << 24) | (((high >> 8) & 0xFF) << 16) | 
                                  ((low & 0xFF) << 8) | ((low >> 8) & 0xFF);
                        break;
                    default:
                        intValue = (low << 16) | high;
                }
                
                if (signed && intValue > 0x7FFFFFFF) {
                    intValue = intValue - 0x100000000;
                }
                
                intArray.push(intValue);
            }
            
            return intArray;
        }

        function convertIntToUshort(intArray, byteOrder) {
            const ushortArray = [];
            
            intArray.forEach(intValue => {
                const uintValue = intValue >>> 0;
                
                switch (byteOrder) {
                    case 'ABCD':
                        ushortArray.push(uintValue & 0xFFFF);
                        ushortArray.push((uintValue >> 16) & 0xFFFF);
                        break;
                    case 'DCBA':
                        ushortArray.push((uintValue >> 16) & 0xFFFF);
                        ushortArray.push(uintValue & 0xFFFF);
                        break;
                    default:
                        ushortArray.push((uintValue >> 16) & 0xFFFF);
                        ushortArray.push(uintValue & 0xFFFF);
                }
            });
            
            return ushortArray;
        }

        function convertToFloat(data, byteOrder) {
            const floatArray = [];
            
            for (let i = 0; i < data.length; i += 2) {
                if (i + 1 >= data.length) break;
                
                const intValue = convertUshortToInt([data[i], data[i + 1]], byteOrder, false)[0];
                const buffer = new ArrayBuffer(4);
                const intView = new Uint32Array(buffer);
                const floatView = new Float32Array(buffer);
                
                intView[0] = intValue;
                floatArray.push(floatView[0]);
            }
            
            return floatArray;
        }

        function convertToDouble(data, byteOrder) {
            const doubleArray = [];
            
            for (let i = 0; i < data.length; i += 4) {
                if (i + 3 >= data.length) break;
                
                // 64ä½åŒç²¾åº¦éœ€è¦4ä¸ª16ä½æ•°æ®
                const part1 = convertUshortToInt([data[i], data[i + 1]], byteOrder, false)[0];
                const part2 = convertUshortToInt([data[i + 2], data[i + 3]], byteOrder, false)[0];
                
                const buffer = new ArrayBuffer(8);
                const intView = new Uint32Array(buffer);
                const doubleView = new Float64Array(buffer);
                
                if (byteOrder === 'ABCD' || byteOrder === 'BADC') {
                    intView[1] = part1;
                    intView[0] = part2;
                } else {
                    intView[0] = part1;
                    intView[1] = part2;
                }
                
                doubleArray.push(doubleView[0]);
            }
            
            return doubleArray;
        }

        function convertToHex(data) {
            return data.map(val => '0x' + val.toString(16).toUpperCase().padStart(4, '0'));
        }

        function convertToBinary(data) {
            return data.map(val => val.toString(2).padStart(16, '0'));
        }

        function convertToBool(data) {
            return data.map(val => val !== 0);
        }

        function convertGeneric(data, sourceType, targetType, byteOrder, signed) {
            // é€šç”¨è½¬æ¢é€»è¾‘
            return data.map(val => {
                switch (targetType) {
                    case 'byte':
                        return val & 0xFF;
                    case 'short':
                        return signed && val > 32767 ? val - 65536 : val;
                    case 'ushort':
                        return val & 0xFFFF;
                    case 'uint':
                        return val >>> 0;
                    case 'long':
                    case 'ulong':
                        return val;
                    default:
                        return val;
                }
            });
        }

        // è‡ªåŠ¨æ£€æµ‹æœ€ä½³é…ç½®
        function autoDetect() {
            const inputData = document.getElementById('inputData').value;
            const parsedData = parseInputData(inputData);
            
            if (parsedData.length === 0) return;
            
            const resultDiv = document.getElementById('result');
            let bestFormat = 'DCBA';
            let bestResults = {};
            
            // æµ‹è¯•æ‰€æœ‰å­—èŠ‚åºæ ¼å¼
            const formats = ['ABCD', 'DCBA', 'BADC', 'CDAB'];
            
            let analysisResult = '<div class="result"><strong>ğŸ” è‡ªåŠ¨æ£€æµ‹ç»“æœ:</strong>\n\n';
            
            formats.forEach(format => {
                try {
                    if (parsedData.length % 2 === 0) {
                        const converted = convertUshortToInt(parsedData, format);
                        bestResults[format] = converted;
                        
                        const score = analyzePattern(converted);
                        analysisResult += `${format}: [${converted.slice(0, 5).join(', ')}${converted.length > 5 ? '...' : ''}] (è¯„åˆ†: ${score})\n`;
                        
                        if (score > (bestResults[bestFormat] ? analyzePattern(bestResults[bestFormat]) : 0)) {
                            bestFormat = format;
                        }
                    }
                } catch (error) {
                    analysisResult += `${format}: è½¬æ¢å¤±è´¥\n`;
                }
            });
            
            analysisResult += `\næ¨èä½¿ç”¨: ${bestFormat} âœ…\n`;
            analysisResult += '</div>';
            
            // åº”ç”¨æœ€ä½³é…ç½®
            document.getElementById('byteOrder').value = bestFormat;
            
            resultDiv.innerHTML = analysisResult;
        }

        // åˆ†ææ•°æ®æ¨¡å¼è¯„åˆ†
        function analyzePattern(data) {
            let score = 0;
            
            // æ£€æŸ¥é‡å¤æ¨¡å¼
            const uniqueValues = new Set(data);
            if (uniqueValues.size < data.length / 2) score += 10;
            
            // æ£€æŸ¥åˆç†èŒƒå›´
            const maxVal = Math.max(...data);
            const minVal = Math.min(...data);
            if (maxVal < 10000 && minVal >= 0) score += 20;
            
            // æ£€æŸ¥åºåˆ—æ¨¡å¼
            let isSequential = true;
            for (let i = 1; i < data.length; i++) {
                if (Math.abs(data[i] - data[i-1]) > 100) {
                    isSequential = false;
                    break;
                }
            }
            if (isSequential) score += 15;
            
            return score;
        }

        // æ˜¾ç¤ºè½¬æ¢ç»“æœ
        function displayResult(result, originalData, sourceType, targetType, byteOrder) {
            const resultDiv = document.getElementById('result');
            const precision = parseInt(document.getElementById('precision').value);
            
            let formattedResult;
            if (targetType === 'real' || targetType === 'double') {
                formattedResult = result.map(val => val.toFixed(precision)).join(', ');
            } else if (targetType === 'hex') {
                formattedResult = result.join(', ');
            } else if (targetType === 'binary') {
                formattedResult = result.join(' ');
            } else if (targetType === 'bool') {
                formattedResult = result.map(val => val ? 'True' : 'False').join(', ');
            } else {
                formattedResult = result.join(', ');
            }
            
            const verification = verifyConversion(result, originalData, sourceType, targetType, byteOrder);
            
            resultDiv.innerHTML = `<div class="result">
<strong>âœ… è½¬æ¢æˆåŠŸ:</strong>
æºæ•°æ® (${sourceType}): [${originalData.join(', ')}]
è½¬æ¢ç»“æœ (${targetType}): [${formattedResult}]

<strong>è½¬æ¢å‚æ•°:</strong>
å­—èŠ‚åº: ${byteOrder}
æ•°æ®é•¿åº¦: ${originalData.length} â†’ ${result.length}
${verification}

<strong>è¯¦ç»†åˆ†æ:</strong>
${getDetailedAnalysis(originalData, result, sourceType, targetType, byteOrder)}
            </div>`;
        }

        // éªŒè¯è½¬æ¢ç»“æœ
        function verifyConversion(result, originalData, sourceType, targetType, byteOrder) {
            if (sourceType === 'ushort' && targetType === 'int' && originalData.length % 2 === 0) {
                try {
                    const backToUshort = convertIntToUshort(result, byteOrder);
                    const matches = JSON.stringify(backToUshort) === JSON.stringify(originalData);
                    return `åå‘éªŒè¯: ${matches ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`;
                } catch (error) {
                    return `åå‘éªŒè¯: âŒ é”™è¯¯ - ${error.message}`;
                }
            }
            return 'éªŒè¯: â„¹ï¸ ä¸é€‚ç”¨æ­¤è½¬æ¢ç±»å‹';
        }

        // è·å–è¯¦ç»†åˆ†æ
        function getDetailedAnalysis(originalData, result, sourceType, targetType, byteOrder) {
            let analysis = '';
            
            if (sourceType === 'ushort' && targetType === 'int') {
                for (let i = 0; i < Math.min(originalData.length / 2, 3); i++) {
                    const idx = i * 2;
                    if (idx + 1 < originalData.length && i < result.length) {
                        const low = originalData[idx];
                        const high = originalData[idx + 1];
                        const intVal = result[i];
                        
                        analysis += `ç¬¬${i + 1}ç»„: [${low}, ${high}] â†’ ${intVal} `;
                        analysis += `(0x${low.toString(16).padStart(4, '0')}, 0x${high.toString(16).padStart(4, '0')} â†’ 0x${(intVal >>> 0).toString(16).padStart(8, '0')})\n`;
                    }
                }
            }
            
            return analysis || 'æ•°æ®è½¬æ¢å®Œæˆ';
        }

        // æ›´æ–°ä½ç¼–è¾‘å™¨
        function updateBitEditor(value = 0) {
            const bitEditor = document.getElementById('bitEditor');
            bitEditor.innerHTML = '';
            
            for (let i = 15; i >= 0; i--) {
                const bit = document.createElement('div');
                bit.className = 'bit';
                bit.textContent = ((value >> i) & 1).toString();
                bit.title = `ä½ ${i}`;
                
                if ((value >> i) & 1) {
                    bit.classList.add('set');
                }
                
                bit.onclick = () => toggleBit(i);
                bitEditor.appendChild(bit);
            }
        }

        // åˆ‡æ¢ä½çŠ¶æ€
        function toggleBit(bitIndex) {
            const inputData = document.getElementById('inputData').value;
            const parsedData = parseInputData(inputData);
            
            if (parsedData.length > 0) {
                parsedData[0] ^= (1 << bitIndex);
                document.getElementById('inputData').value = '[' + parsedData.join(',') + ']';
                updateBitEditor(parsedData[0]);
            }
        }

        // æ ¼å¼åŒ–è¾“å…¥
        function formatInput() {
            const input = document.getElementById('inputData').value;
            const parsed = parseInputData(input);
            document.getElementById('inputData').value = '[' + parsed.join(', ') + ']';
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard() {
            const resultDiv = document.getElementById('result');
            if (resultDiv.textContent) {
                navigator.clipboard.writeText(resultDiv.textContent).then(() => {
                    alert('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });
            }
        }

        // å¯¼å‡ºç»“æœ
        function exportResult() {
            const resultDiv = document.getElementById('result');
            if (!resultDiv.textContent) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„ç»“æœ');
                return;
            }
            
            const data = {
                timestamp: new Date().toISOString(),
                input: document.getElementById('inputData').value,
                result: resultDiv.textContent,
                config: {
                    plcBrand: document.getElementById('plcBrand').value,
                    sourceType: document.getElementById('sourceType').value,
                    targetType: document.getElementById('targetType').value,
                    byteOrder: document.getElementById('byteOrder').value
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `plc_conversion_${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // æ¸…ç©ºæ‰€æœ‰æ•°æ®
        function clearAll() {
            document.getElementById('inputData').value = '';
            document.getElementById('result').innerHTML = '';
            updateBitEditor(0);
        }

        // æ˜¾ç¤ºå¯¹æ¯”
        function showComparison() {
            // å®ç°æ•°æ®å¯¹æ¯”åŠŸèƒ½
            alert('å¯¹æ¯”åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // åˆ‡æ¢å¸®åŠ©é¢æ¿
        function toggleHelp() {
            const helpPanel = document.getElementById('helpPanel');
            helpPanel.style.display = helpPanel.style.display === 'flex' ? 'none' : 'flex';
        }

        // ä»æ–‡ä»¶å¯¼å…¥
        function importFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.csv,.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('inputData').value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // ä¿å­˜å½“å‰é¢„è®¾
        function saveCurrentPreset() {
            const name = prompt('è¯·è¾“å…¥é¢„è®¾åç§°:');
            if (name) {
                const config = {
                    name: name,
                    plcBrand: document.getElementById('plcBrand').value,
                    sourceType: document.getElementById('sourceType').value,
                    targetType: document.getElementById('targetType').value,
                    byteOrder: document.getElementById('byteOrder').value,
                    signed: document.getElementById('signedData').checked
                };
                
                localStorage.setItem('plc_preset_' + name, JSON.stringify(config));
                alert('é¢„è®¾å·²ä¿å­˜ï¼');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è½¬æ¢ç¤ºä¾‹æ•°æ®
        setTimeout(() => {
            convertData();
        }, 500);
    </script>
</body>
</html>