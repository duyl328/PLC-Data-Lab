<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈÄöÁî®PLCÊï∞ÊçÆËΩ¨Êç¢Â∑•ÂÖ∑</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: auto;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .panel h3 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button.secondary {
            background: linear-gradient(45deg, #718096, #2d3748);
        }

        button.success {
            background: linear-gradient(45deg, #48bb78, #38a169);
        }

        button.warning {
            background: linear-gradient(45deg, #ed8936, #dd6b20);
        }

        .result-panel {
            grid-column: 1 / -1;
        }

        .result {
            background: linear-gradient(135deg, #f0fff4, #e6fffa);
            border: 2px solid #48bb78;
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        .error {
            background: linear-gradient(135deg, #fed7d7, #ffeaea);
            border-color: #f56565;
            color: #c53030;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            background: #f7fafc;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .preset-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .preset-card:hover {
            border-color: #667eea;
            background: #eef2ff;
            transform: translateY(-2px);
        }

        .preset-card.active {
            border-color: #667eea;
            background: #eef2ff;
        }

        .preset-card h4 {
            color: #4a5568;
            margin-bottom: 5px;
        }

        .preset-card p {
            color: #718096;
            font-size: 12px;
        }

        .format-examples {
            background: #fafafa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border-left: 4px solid #667eea;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .bit-display {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            margin: 10px 0;
        }

        .bit {
            background: #f1f5f9;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            padding: 8px 4px;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bit.set {
            background: #48bb78;
            color: white;
        }

        .floating-help {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .help-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .help-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß ÈÄöÁî®PLCÊï∞ÊçÆËΩ¨Êç¢Â∑•ÂÖ∑</h1>
            <p>ÊîØÊåÅÊâÄÊúâ‰∏ªÊµÅPLCÂìÅÁâåÂíåÊï∞ÊçÆÊ†ºÂºèÁöÑ‰∏ì‰∏öËΩ¨Êç¢Â∑•ÂÖ∑</p>
        </div>

        <div class="main-grid">
            <!-- Â∑¶‰æßÔºöÈÖçÁΩÆÈù¢Êùø -->
            <div class="panel">
                <h3><span class="icon">‚öôÔ∏è</span>ËΩ¨Êç¢ÈÖçÁΩÆ</h3>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('basic')">Âü∫Á°ÄËΩ¨Êç¢</div>
                    <div class="tab" onclick="switchTab('advanced')">È´òÁ∫ßÈÄâÈ°π</div>
                    <div class="tab" onclick="switchTab('presets')">È¢ÑËÆæÈÖçÁΩÆ</div>
                </div>

                <!-- Âü∫Á°ÄËΩ¨Êç¢ -->
                <div id="basic" class="tab-content active">
                    <div class="form-group">
                        <label>PLCÂìÅÁâå</label>
                        <select id="plcBrand" onchange="updatePresets()">
                            <option value="omron">Ê¨ßÂßÜÈæô (Omron)</option>
                            <option value="siemens">Ë•øÈó®Â≠ê (Siemens)</option>
                            <option value="mitsubishi">‰∏âËè± (Mitsubishi)</option>
                            <option value="ab">ÁΩóÂÖãÈü¶Â∞î (Allen-Bradley)</option>
                            <option value="schneider">ÊñΩËÄêÂæ∑ (Schneider)</option>
                            <option value="delta">Âè∞Ëææ (Delta)</option>
                            <option value="keyence">Âü∫ÊÅ©Â£´ (Keyence)</option>
                            <option value="panasonic">Êùæ‰∏ã (Panasonic)</option>
                            <option value="custom">Ëá™ÂÆö‰πâ</option>
                        </select>
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label>Ê∫êÊï∞ÊçÆÁ±ªÂûã</label>
                            <select id="sourceType">
                                <option value="ushort">USHORT (16‰Ωç)</option>
                                <option value="short">SHORT (16‰Ωç)</option>
                                <option value="uint">UINT (32‰Ωç)</option>
                                <option value="int">INT (32‰Ωç)</option>
                                <option value="ulong">ULONG (64‰Ωç)</option>
                                <option value="long">LONG (64‰Ωç)</option>
                                <option value="byte">BYTE (8‰Ωç)</option>
                                <option value="bool">BOOL (1‰Ωç)</option>
                                <option value="real">REAL (32‰ΩçÊµÆÁÇπ)</option>
                                <option value="double">DOUBLE (64‰ΩçÊµÆÁÇπ)</option>
                                <option value="string">STRING</option>
                                <option value="raw">ÂéüÂßãÊï∞ÊçÆ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>ÁõÆÊ†áÊï∞ÊçÆÁ±ªÂûã</label>
                            <select id="targetType">
                                <option value="int">INT (32‰Ωç)</option>
                                <option value="uint">UINT (32‰Ωç)</option>
                                <option value="short">SHORT (16‰Ωç)</option>
                                <option value="ushort">USHORT (16‰Ωç)</option>
                                <option value="long">LONG (64‰Ωç)</option>
                                <option value="ulong">ULONG (64‰Ωç)</option>
                                <option value="byte">BYTE (8‰Ωç)</option>
                                <option value="bool">BOOL (1‰Ωç)</option>
                                <option value="real">REAL (32‰ΩçÊµÆÁÇπ)</option>
                                <option value="double">DOUBLE (64‰ΩçÊµÆÁÇπ)</option>
                                <option value="string">STRING</option>
                                <option value="hex">ÂçÅÂÖ≠ËøõÂà∂</option>
                                <option value="binary">‰∫åËøõÂà∂</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid-3">
                        <div class="form-group">
                            <label>Â≠óËäÇÂ∫è</label>
                            <select id="byteOrder">
                                <option value="ABCD">ABCD (Â§ßÁ´ØÂ∫è)</option>
                                <option value="DCBA">DCBA (Â∞èÁ´ØÂ∫è)</option>
                                <option value="BADC">BADC (Ê∑∑ÂêàÂ∫è1)</option>
                                <option value="CDAB">CDAB (Ê∑∑ÂêàÂ∫è2)</option>
                                <option value="auto">Ëá™Âä®Ê£ÄÊµã</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>‰ΩçÂ∫è</label>
                            <select id="bitOrder">
                                <option value="msb">MSB‰ºòÂÖà</option>
                                <option value="lsb">LSB‰ºòÂÖà</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Êï∞ÊçÆÊ†ºÂºè</label>
                            <select id="dataFormat">
                                <option value="decimal">ÂçÅËøõÂà∂</option>
                                <option value="hex">ÂçÅÂÖ≠ËøõÂà∂</option>
                                <option value="binary">‰∫åËøõÂà∂</option>
                                <option value="array">Êï∞ÁªÑ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- È´òÁ∫ßÈÄâÈ°π -->
                <div id="advanced" class="tab-content">
                    <div class="grid-2">
                        <div class="form-group">
                            <label>ÂÅèÁßªÈáè (Â≠óËäÇ)</label>
                            <input type="number" id="offset" value="0" min="0">
                        </div>

                        <div class="form-group">
                            <label>Êï∞ÊçÆÈïøÂ∫¶ÈôêÂà∂</label>
                            <input type="number" id="lengthLimit" value="0" min="0" placeholder="0=Êó†ÈôêÂà∂">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="signedData" checked>
                            ÊúâÁ¨¶Âè∑Êï∞ÊçÆ
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="reverseOrder">
                            ÂèçËΩ¨Êï∞ÁªÑÈ°∫Â∫è
                        </label>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ignoreErrors">
                            ÂøΩÁï•ËΩ¨Êç¢ÈîôËØØ
                        </label>
                    </div>

                    <div class="form-group">
                        <label>ÊµÆÁÇπÊï∞Á≤æÂ∫¶</label>
                        <input type="number" id="precision" value="6" min="0" max="15">
                    </div>

                    <div class="form-group">
                        <label>Â≠óÁ¨¶‰∏≤ÁºñÁ†Å</label>
                        <select id="encoding">
                            <option value="utf8">UTF-8</option>
                            <option value="ascii">ASCII</option>
                            <option value="gbk">GBK</option>
                            <option value="unicode">Unicode</option>
                        </select>
                    </div>
                </div>

                <!-- È¢ÑËÆæÈÖçÁΩÆ -->
                <div id="presets" class="tab-content">
                    <div class="preset-grid" id="presetGrid">
                        <!-- È¢ÑËÆæÈÖçÁΩÆÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>

                    <div class="button-group">
                        <button onclick="saveCurrentPreset()">üíæ ‰øùÂ≠òÂΩìÂâçÈÖçÁΩÆ</button>
                        <button onclick="loadPreset()" class="secondary">üìÅ Âä†ËΩΩÈÖçÁΩÆÊñá‰ª∂</button>
                        <input type="file" id="fileInput" style="display:none" accept=".json">
                    </div>
                </div>

                <div class="button-group">
                    <button onclick="convertData()">üîÑ ËΩ¨Êç¢Êï∞ÊçÆ</button>
                    <button onclick="autoDetect()" class="warning">üîç Ëá™Âä®Ê£ÄÊµã</button>
                    <button onclick="clearAll()" class="secondary">üóëÔ∏è Ê∏ÖÁ©∫</button>
                </div>
            </div>

            <!-- Âè≥‰æßÔºöÊï∞ÊçÆËæìÂÖ•Èù¢Êùø -->
            <div class="panel">
                <h3><span class="icon">üì•</span>Êï∞ÊçÆËæìÂÖ•</h3>
                
                <div class="form-group">
                    <label>ÂéüÂßãÊï∞ÊçÆ</label>
                    <textarea id="inputData" placeholder="ËæìÂÖ•‰Ω†ÁöÑPLCÊï∞ÊçÆÔºåÊîØÊåÅÂ§öÁßçÊ†ºÂºèÔºö
[256,0,256,0,256,0]
256,0,256,0,256,0
0x0100,0x0000,0x0100
01000000 00000000...">[256,0,256,0,256,0,256,0,256,0]</textarea>
                </div>

                <div class="button-group">
                    <button onclick="loadSampleData()" class="secondary">üìù Âä†ËΩΩÁ§∫‰æã</button>
                    <button onclick="importFromFile()" class="secondary">üìÇ ‰ªéÊñá‰ª∂ÂØºÂÖ•</button>
                    <button onclick="formatInput()">üé® Ê†ºÂºèÂåñ</button>
                </div>

                <div class="format-examples">
                    <strong>ÊîØÊåÅÁöÑËæìÂÖ•Ê†ºÂºèÔºö</strong><br>
                    Êï∞ÁªÑ: [1,2,3] Êàñ 1,2,3<br>
                    ÂçÅÂÖ≠ËøõÂà∂: 0x01,0x02 Êàñ 01 02<br>
                    ‰∫åËøõÂà∂: 00000001 00000010<br>
                    Ê∑∑Âêà: 1 0x02 00000011
                </div>

                <!-- ‰ΩçÁºñËæëÂô® -->
                <div class="form-group">
                    <label>‰ΩçÁºñËæëÂô® <small>(ÁÇπÂáªÂàáÊç¢‰ΩçÁä∂ÊÄÅ)</small></label>
                    <div id="bitEditor" class="bit-display">
                        <!-- ‰ΩçÊòæÁ§∫Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ÁªìÊûúÈù¢Êùø -->
        <div class="panel result-panel">
            <h3><span class="icon">üì§</span>ËΩ¨Êç¢ÁªìÊûú</h3>
            
            <div class="button-group">
                <button onclick="exportResult()" class="success">üíæ ÂØºÂá∫ÁªìÊûú</button>
                <button onclick="copyToClipboard()" class="success">üìã Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</button>
                <button onclick="showComparison()" class="secondary">üîç ÊòæÁ§∫ÂØπÊØî</button>
            </div>

            <div id="result"></div>
        </div>
    </div>

    <!-- ÊµÆÂä®Â∏ÆÂä©ÊåâÈíÆ -->
    <div class="floating-help" onclick="toggleHelp()">‚ùì</div>

    <!-- Â∏ÆÂä©Èù¢Êùø -->
    <div class="help-panel" id="helpPanel" onclick="toggleHelp()">
        <div class="help-content" onclick="event.stopPropagation()">
            <h2>üìö ‰ΩøÁî®Â∏ÆÂä©</h2>
            <h3>PLCÂìÅÁâåÁâπËâ≤Ôºö</h3>
            <ul>
                <li><strong>Ê¨ßÂßÜÈæô:</strong> ÈÄöÂ∏∏‰ΩøÁî®Â∞èÁ´ØÂ∫èÔºåÊîØÊåÅCJ/CP/CSÁ≥ªÂàó</li>
                <li><strong>Ë•øÈó®Â≠ê:</strong> S7Á≥ªÂàóÔºåÂ§ßÁ´ØÂ∫è‰∏∫‰∏ª</li>
                <li><strong>‰∏âËè±:</strong> FX/QÁ≥ªÂàóÔºåÊ∑∑ÂêàÂ≠óËäÇÂ∫èÂ∏∏ËßÅ</li>
                <li><strong>AB:</strong> CompactLogix/ControlLogixÔºåÂ∞èÁ´ØÂ∫è</li>
                <li><strong>ÊñΩËÄêÂæ∑:</strong> ModiconÁ≥ªÂàóÔºåÂ§ßÁ´ØÂ∫è</li>
            </ul>
            
            <h3>Êï∞ÊçÆÁ±ªÂûãËØ¥ÊòéÔºö</h3>
            <ul>
                <li><strong>BOOL:</strong> 1‰ΩçÂ∏ÉÂ∞îÂÄº</li>
                <li><strong>BYTE:</strong> 8‰ΩçÊó†Á¨¶Âè∑Êï¥Êï∞ (0-255)</li>
                <li><strong>USHORT:</strong> 16‰ΩçÊó†Á¨¶Âè∑Êï¥Êï∞ (0-65535)</li>
                <li><strong>INT:</strong> 32‰ΩçÊúâÁ¨¶Âè∑Êï¥Êï∞</li>
                <li><strong>REAL:</strong> 32‰ΩçIEEE754ÊµÆÁÇπÊï∞</li>
            </ul>

            <h3>Â≠óËäÇÂ∫èËØ¥ÊòéÔºö</h3>
            <ul>
                <li><strong>ABCD:</strong> Â§ßÁ´ØÂ∫èÔºåÈ´òÂ≠óËäÇÂú®Ââç</li>
                <li><strong>DCBA:</strong> Â∞èÁ´ØÂ∫èÔºå‰ΩéÂ≠óËäÇÂú®Ââç</li>
                <li><strong>BADC/CDAB:</strong> Â≠óËäÇÂØπË∞ÉÁöÑÊ∑∑ÂêàÊ®°Âºè</li>
            </ul>

            <button onclick="toggleHelp()" style="margin-top: 20px;">ÂÖ≥Èó≠Â∏ÆÂä©</button>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentPresets = {};
        let conversionHistory = [];

        // PLCÂìÅÁâåÈ¢ÑËÆæÈÖçÁΩÆ
        const plcPresets = {
            omron: {
                name: "Ê¨ßÂßÜÈæôÈªòËÆ§",
                byteOrder: "DCBA",
                bitOrder: "lsb",
                signed: true,
                description: "ÈÄÇÁî®‰∫éCJ/CP/CSÁ≥ªÂàó"
            },
            siemens: {
                name: "Ë•øÈó®Â≠êÈªòËÆ§", 
                byteOrder: "ABCD",
                bitOrder: "msb",
                signed: true,
                description: "ÈÄÇÁî®‰∫éS7-300/400/1500"
            },
            mitsubishi: {
                name: "‰∏âËè±ÈªòËÆ§",
                byteOrder: "BADC", 
                bitOrder: "lsb",
                signed: true,
                description: "ÈÄÇÁî®‰∫éFX/QÁ≥ªÂàó"
            },
            ab: {
                name: "ABÈªòËÆ§",
                byteOrder: "DCBA",
                bitOrder: "lsb", 
                signed: true,
                description: "ÈÄÇÁî®‰∫éCompactLogix"
            },
            schneider: {
                name: "ÊñΩËÄêÂæ∑ÈªòËÆ§",
                byteOrder: "ABCD",
                bitOrder: "msb",
                signed: true,
                description: "ÈÄÇÁî®‰∫éModiconÁ≥ªÂàó"
            }
        };

        // ÂàùÂßãÂåñ
        window.onload = function() {
            updatePresets();
            updateBitEditor();
            loadSampleData();
        };

        // ÂàáÊç¢Ê†áÁ≠æÈ°µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Êõ¥Êñ∞È¢ÑËÆæÈÖçÁΩÆ
        function updatePresets() {
            const brand = document.getElementById('plcBrand').value;
            const presetGrid = document.getElementById('presetGrid');
            
            presetGrid.innerHTML = '';
            
            Object.entries(plcPresets).forEach(([key, preset]) => {
                const card = document.createElement('div');
                card.className = 'preset-card';
                if (key === brand) card.classList.add('active');
                
                card.innerHTML = `
                    <h4>${preset.name}</h4>
                    <p>${preset.description}</p>
                `;
                
                card.onclick = () => applyPreset(key);
                presetGrid.appendChild(card);
            });
        }

        // Â∫îÁî®È¢ÑËÆæÈÖçÁΩÆ
        function applyPreset(presetKey) {
            const preset = plcPresets[presetKey];
            if (!preset) return;
            
            document.getElementById('byteOrder').value = preset.byteOrder;
            document.getElementById('bitOrder').value = preset.bitOrder;
            document.getElementById('signedData').checked = preset.signed;
            document.getElementById('plcBrand').value = presetKey;
            
            updatePresets();
        }

        // Âä†ËΩΩÁ§∫‰æãÊï∞ÊçÆ
        function loadSampleData() {
            const samples = [
                "[256,0,256,0,256,0,256,0,256,0]",
                "0x0100,0x0000,0x0100,0x0000",
                "1,0,1,0,1,0,1,0,1,0",
                "00000001 00000000 00000001 00000000"
            ];
            
            const randomSample = samples[Math.floor(Math.random() * samples.length)];
            document.getElementById('inputData').value = randomSample;
        }

        // Ëß£ÊûêËæìÂÖ•Êï∞ÊçÆ
        function parseInputData(input) {
            input = input.trim();
            
            // ÁßªÈô§Êï∞ÁªÑÊã¨Âè∑
            if (input.startsWith('[') && input.endsWith(']')) {
                input = input.slice(1, -1);
            }
            
            // ÂàÜÂâ≤Êï∞ÊçÆ
            let values = [];
            
            if (input.includes(',')) {
                values = input.split(',');
            } else {
                values = input.split(/\s+/);
            }
            
            // Ëß£ÊûêÊØè‰∏™ÂÄº
            return values.map(val => {
                val = val.trim();
                if (val.startsWith('0x') || val.startsWith('0X')) {
                    return parseInt(val, 16);
                } else if (/^[01]+$/.test(val) && val.length > 4) {
                    return parseInt(val, 2);
                } else {
                    return parseInt(val, 10);
                }
            }).filter(val => !isNaN(val));
        }

        // ‰∏ªË¶ÅËΩ¨Êç¢ÂáΩÊï∞
        function convertData() {
            const inputData = document.getElementById('inputData').value;
            const sourceType = document.getElementById('sourceType').value;
            const targetType = document.getElementById('targetType').value;
            const byteOrder = document.getElementById('byteOrder').value;
            const signed = document.getElementById('signedData').checked;
            const resultDiv = document.getElementById('result');

            try {
                const parsedData = parseInputData(inputData);
                if (parsedData.length === 0) {
                    throw new Error('Êó†Ê≥ïËß£ÊûêËæìÂÖ•Êï∞ÊçÆ');
                }

                let result;
                
                // Ê†πÊçÆËΩ¨Êç¢Á±ªÂûãËøõË°åÂ§ÑÁêÜ
                if (sourceType === 'ushort' && targetType === 'int') {
                    result = convertUshortToInt(parsedData, byteOrder, signed);
                } else if (sourceType === 'int' && targetType === 'ushort') {
                    result = convertIntToUshort(parsedData, byteOrder);
                } else if (targetType === 'real') {
                    result = convertToFloat(parsedData, byteOrder);
                } else if (targetType === 'double') {
                    result = convertToDouble(parsedData, byteOrder);
                } else if (targetType === 'hex') {
                    result = convertToHex(parsedData);
                } else if (targetType === 'binary') {
                    result = convertToBinary(parsedData);
                } else if (targetType === 'bool') {
                    result = convertToBool(parsedData);
                } else {
                    result = convertGeneric(parsedData, sourceType, targetType, byteOrder, signed);
                }

                displayResult(result, parsedData, sourceType, targetType, byteOrder);
                updateBitEditor(parsedData[0] || 0);
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">ËΩ¨Êç¢ÈîôËØØ: ${error.message}</div>`;
            }
        }

        // ËΩ¨Êç¢ÂáΩÊï∞ÂÆûÁé∞
        function convertUshortToInt(ushortArray, byteOrder, signed = true) {
            if (ushortArray.length % 2 !== 0) {
                throw new Error('USHORTÂà∞INTËΩ¨Êç¢ÈúÄË¶ÅÂÅ∂Êï∞‰∏™Êï∞ÊçÆ');
            }
            
            const intArray = [];
            
            for (let i = 0; i < ushortArray.length; i += 2) {
                const low = ushortArray[i];
                const high = ushortArray[i + 1];
                
                let intValue;
                switch (byteOrder) {
                    case 'ABCD':
                        intValue = (high << 16) | low;
                        break;
                    case 'DCBA':
                        intValue = (low << 16) | high;
                        break;
                    case 'BADC':
                        intValue = ((low & 0xFF) << 24) | (((low >> 8) & 0xFF) << 16) | 
                                  ((high & 0xFF) << 8) | ((high >> 8) & 0xFF);
                        break;
                    case 'CDAB':
                        intValue = ((high & 0xFF) << 24) | (((high >> 8) & 0xFF) << 16) | 
                                  ((low & 0xFF) << 8) | ((low >> 8) & 0xFF);
                        break;
                    default:
                        intValue = (low << 16) | high;
                }
                
                if (signed && intValue > 0x7FFFFFFF) {
                    intValue = intValue - 0x100000000;
                }
                
                intArray.push(intValue);
            }
            
            return intArray;
        }

        function convertIntToUshort(intArray, byteOrder) {
            const ushortArray = [];
            
            intArray.forEach(intValue => {
                const uintValue = intValue >>> 0;
                
                switch (byteOrder) {
                    case 'ABCD':
                        ushortArray.push(uintValue & 0xFFFF);
                        ushortArray.push((uintValue >> 16) & 0xFFFF);
                        break;
                    case 'DCBA':
                        ushortArray.push((uintValue >> 16) & 0xFFFF);
                        ushortArray.push(uintValue & 0xFFFF);
                        break;
                    default:
                        ushortArray.push((uintValue >> 16) & 0xFFFF);
                        ushortArray.push(uintValue & 0xFFFF);
                }
            });
            
            return ushortArray;
        }

        function convertToFloat(data, byteOrder) {
            const floatArray = [];
            
            for (let i = 0; i < data.length; i += 2) {
                if (i + 1 >= data.length) break;
                
                const intValue = convertUshortToInt([data[i], data[i + 1]], byteOrder, false)[0];
                const buffer = new ArrayBuffer(4);
                const intView = new Uint32Array(buffer);
                const floatView = new Float32Array(buffer);
                
                intView[0] = intValue;
                floatArray.push(floatView[0]);
            }
            
            return floatArray;
        }

        function convertToDouble(data, byteOrder) {
            const doubleArray = [];
            
            for (let i = 0; i < data.length; i += 4) {
                if (i + 3 >= data.length) break;
                
                // 64‰ΩçÂèåÁ≤æÂ∫¶ÈúÄË¶Å4‰∏™16‰ΩçÊï∞ÊçÆ
                const part1 = convertUshortToInt([data[i], data[i + 1]], byteOrder, false)[0];
                const part2 = convertUshortToInt([data[i + 2], data[i + 3]], byteOrder, false)[0];
                
                const buffer = new ArrayBuffer(8);
                const intView = new Uint32Array(buffer);
                const doubleView = new Float64Array(buffer);
                
                if (byteOrder === 'ABCD' || byteOrder === 'BADC') {
                    intView[1] = part1;
                    intView[0] = part2;
                } else {
                    intView[0] = part1;
                    intView[1] = part2;
                }
                
                doubleArray.push(doubleView[0]);
            }
            
            return doubleArray;
        }

        function convertToHex(data) {
            return data.map(val => '0x' + val.toString(16).toUpperCase().padStart(4, '0'));
        }

        function convertToBinary(data) {
            return data.map(val => val.toString(2).padStart(16, '0'));
        }

        function convertToBool(data) {
            return data.map(val => val !== 0);
        }

        function convertGeneric(data, sourceType, targetType, byteOrder, signed) {
            // ÈÄöÁî®ËΩ¨Êç¢ÈÄªËæë
            return data.map(val => {
                switch (targetType) {
                    case 'byte':
                        return val & 0xFF;
                    case 'short':
                        return signed && val > 32767 ? val - 65536 : val;
                    case 'ushort':
                        return val & 0xFFFF;
                    case 'uint':
                        return val >>> 0;
                    case 'long':
                    case 'ulong':
                        return val;
                    default:
                        return val;
                }
            });
        }

        // Ëá™Âä®Ê£ÄÊµãÊúÄ‰Ω≥ÈÖçÁΩÆ
        function autoDetect() {
            const inputData = document.getElementById('inputData').value;
            const parsedData = parseInputData(inputData);
            
            if (parsedData.length === 0) return;
            
            const resultDiv = document.getElementById('result');
            let bestFormat = 'DCBA';
            let bestResults = {};
            
            // ÊµãËØïÊâÄÊúâÂ≠óËäÇÂ∫èÊ†ºÂºè
            const formats = ['ABCD', 'DCBA', 'BADC', 'CDAB'];
            
            let analysisResult = '<div class="result"><strong>üîç Ëá™Âä®Ê£ÄÊµãÁªìÊûú:</strong>\n\n';
            
            formats.forEach(format => {
                try {
                    if (parsedData.length % 2 === 0) {
                        const converted = convertUshortToInt(parsedData, format);
                        bestResults[format] = converted;
                        
                        const score = analyzePattern(converted);
                        analysisResult += `${format}: [${converted.slice(0, 5).join(', ')}${converted.length > 5 ? '...' : ''}] (ËØÑÂàÜ: ${score})\n`;
                        
                        if (score > (bestResults[bestFormat] ? analyzePattern(bestResults[bestFormat]) : 0)) {
                            bestFormat = format;
                        }
                    }
                } catch (error) {
                    analysisResult += `${format}: ËΩ¨Êç¢Â§±Ë¥•\n`;
                }
            });
            
            analysisResult += `\nÊé®Ëçê‰ΩøÁî®: ${bestFormat} ‚úÖ\n`;
            analysisResult += '</div>';
            
            // Â∫îÁî®ÊúÄ‰Ω≥ÈÖçÁΩÆ
            document.getElementById('byteOrder').value = bestFormat;
            
            resultDiv.innerHTML = analysisResult;
        }

        // ÂàÜÊûêÊï∞ÊçÆÊ®°ÂºèËØÑÂàÜ
        function analyzePattern(data) {
            let score = 0;
            
            // Ê£ÄÊü•ÈáçÂ§çÊ®°Âºè
            const uniqueValues = new Set(data);
            if (uniqueValues.size < data.length / 2) score += 10;
            
            // Ê£ÄÊü•ÂêàÁêÜËåÉÂõ¥
            const maxVal = Math.max(...data);
            const minVal = Math.min(...data);
            if (maxVal < 10000 && minVal >= 0) score += 20;
            
            // Ê£ÄÊü•Â∫èÂàóÊ®°Âºè
            let isSequential = true;
            for (let i = 1; i < data.length; i++) {
                if (Math.abs(data[i] - data[i-1]) > 100) {
                    isSequential = false;
                    break;
                }
            }
            if (isSequential) score += 15;
            
            return score;
        }

        // ÊòæÁ§∫ËΩ¨Êç¢ÁªìÊûú
        function displayResult(result, originalData, sourceType, targetType, byteOrder) {
            const resultDiv = document.getElementById('result');
            const precision = parseInt(document.getElementById('precision').value);
            
            let formattedResult;
            if (targetType === 'real' || targetType === 'double') {
                formattedResult = result.map(val => val.toFixed(precision)).join(', ');
            } else if (targetType === 'hex') {
                formattedResult = result.join(', ');
            } else if (targetType === 'binary') {
                formattedResult = result.join(' ');
            } else if (targetType === 'bool') {
                formattedResult = result.map(val => val ? 'True' : 'False').join(', ');
            } else {
                formattedResult = result.join(', ');
            }
            
            const verification = verifyConversion(result, originalData, sourceType, targetType, byteOrder);
            
            resultDiv.innerHTML = `<div class="result">
<strong>‚úÖ ËΩ¨Êç¢ÊàêÂäü:</strong>
Ê∫êÊï∞ÊçÆ (${sourceType}): [${originalData.join(', ')}]
ËΩ¨Êç¢ÁªìÊûú (${targetType}): [${formattedResult}]

<strong>ËΩ¨Êç¢ÂèÇÊï∞:</strong>
Â≠óËäÇÂ∫è: ${byteOrder}
Êï∞ÊçÆÈïøÂ∫¶: ${originalData.length} ‚Üí ${result.length}
${verification}

<strong>ËØ¶ÁªÜÂàÜÊûê:</strong>
${getDetailedAnalysis(originalData, result, sourceType, targetType, byteOrder)}
            </div>`;
        }

        // È™åËØÅËΩ¨Êç¢ÁªìÊûú
        function verifyConversion(result, originalData, sourceType, targetType, byteOrder) {
            if (sourceType === 'ushort' && targetType === 'int' && originalData.length % 2 === 0) {
                try {
                    const backToUshort = convertIntToUshort(result, byteOrder);
                    const matches = JSON.stringify(backToUshort) === JSON.stringify(originalData);
                    return `ÂèçÂêëÈ™åËØÅ: ${matches ? '‚úÖ ÈÄöËøá' : '‚ùå Â§±Ë¥•'}`;
                } catch (error) {
                    return `ÂèçÂêëÈ™åËØÅ: ‚ùå ÈîôËØØ - ${error.message}`;
                }
            }
            return 'È™åËØÅ: ‚ÑπÔ∏è ‰∏çÈÄÇÁî®Ê≠§ËΩ¨Êç¢Á±ªÂûã';
        }

        // Ëé∑ÂèñËØ¶ÁªÜÂàÜÊûê
        function getDetailedAnalysis(originalData, result, sourceType, targetType, byteOrder) {
            let analysis = '';
            
            if (sourceType === 'ushort' && targetType === 'int') {
                for (let i = 0; i < Math.min(originalData.length / 2, 3); i++) {
                    const idx = i * 2;
                    if (idx + 1 < originalData.length && i < result.length) {
                        const low = originalData[idx];
                        const high = originalData[idx + 1];
                        const intVal = result[i];
                        
                        analysis += `Á¨¨${i + 1}ÁªÑ: [${low}, ${high}] ‚Üí ${intVal} `;
                        analysis += `(0x${low.toString(16).padStart(4, '0')}, 0x${high.toString(16).padStart(4, '0')} ‚Üí 0x${(intVal >>> 0).toString(16).padStart(8, '0')})\n`;
                    }
                }
            }
            
            return analysis || 'Êï∞ÊçÆËΩ¨Êç¢ÂÆåÊàê';
        }

        // Êõ¥Êñ∞‰ΩçÁºñËæëÂô®
        function updateBitEditor(value = 0) {
            const bitEditor = document.getElementById('bitEditor');
            bitEditor.innerHTML = '';
            
            for (let i = 15; i >= 0; i--) {
                const bit = document.createElement('div');
                bit.className = 'bit';
                bit.textContent = ((value >> i) & 1).toString();
                bit.title = `‰Ωç ${i}`;
                
                if ((value >> i) & 1) {
                    bit.classList.add('set');
                }
                
                bit.onclick = () => toggleBit(i);
                bitEditor.appendChild(bit);
            }
        }

        // ÂàáÊç¢‰ΩçÁä∂ÊÄÅ
        function toggleBit(bitIndex) {
            const inputData = document.getElementById('inputData').value;
            const parsedData = parseInputData(inputData);
            
            if (parsedData.length > 0) {
                parsedData[0] ^= (1 << bitIndex);
                document.getElementById('inputData').value = '[' + parsedData.join(',') + ']';
                updateBitEditor(parsedData[0]);
            }
        }

        // Ê†ºÂºèÂåñËæìÂÖ•
        function formatInput() {
            const input = document.getElementById('inputData').value;
            const parsed = parseInputData(input);
            document.getElementById('inputData').value = '[' + parsed.join(', ') + ']';
        }

        // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
        function copyToClipboard() {
            const resultDiv = document.getElementById('result');
            if (resultDiv.textContent) {
                navigator.clipboard.writeText(resultDiv.textContent).then(() => {
                    alert('ÁªìÊûúÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                });
            }
        }

        // ÂØºÂá∫ÁªìÊûú
        function exportResult() {
            const resultDiv = document.getElementById('result');
            if (!resultDiv.textContent) {
                alert('Ê≤°ÊúâÂèØÂØºÂá∫ÁöÑÁªìÊûú');
                return;
            }
            
            const data = {
                timestamp: new Date().toISOString(),
                input: document.getElementById('inputData').value,
                result: resultDiv.textContent,
                config: {
                    plcBrand: document.getElementById('plcBrand').value,
                    sourceType: document.getElementById('sourceType').value,
                    targetType: document.getElementById('targetType').value,
                    byteOrder: document.getElementById('byteOrder').value
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `plc_conversion_${new Date().getTime()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Ê∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆ
        function clearAll() {
            document.getElementById('inputData').value = '';
            document.getElementById('result').innerHTML = '';
            updateBitEditor(0);
        }

        // ÊòæÁ§∫ÂØπÊØî
        function showComparison() {
            // ÂÆûÁé∞Êï∞ÊçÆÂØπÊØîÂäüËÉΩ
            alert('ÂØπÊØîÂäüËÉΩÂºÄÂèë‰∏≠...');
        }

        // ÂàáÊç¢Â∏ÆÂä©Èù¢Êùø
        function toggleHelp() {
            const helpPanel = document.getElementById('helpPanel');
            helpPanel.style.display = helpPanel.style.display === 'flex' ? 'none' : 'flex';
        }

        // ‰ªéÊñá‰ª∂ÂØºÂÖ•
        function importFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.csv,.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('inputData').value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // ‰øùÂ≠òÂΩìÂâçÈ¢ÑËÆæ
        function saveCurrentPreset() {
            const name = prompt('ËØ∑ËæìÂÖ•È¢ÑËÆæÂêçÁß∞:');
            if (name) {
                const config = {
                    name: name,
                    plcBrand: document.getElementById('plcBrand').value,
                    sourceType: document.getElementById('sourceType').value,
                    targetType: document.getElementById('targetType').value,
                    byteOrder: document.getElementById('byteOrder').value,
                    signed: document.getElementById('signedData').checked
                };
                
                localStorage.setItem('plc_preset_' + name, JSON.stringify(config));
                alert('È¢ÑËÆæÂ∑≤‰øùÂ≠òÔºÅ');
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂Ëá™Âä®ËΩ¨Êç¢Á§∫‰æãÊï∞ÊçÆ
        setTimeout(() => {
            convertData();
        }, 500);
    </script>
</body>
</html>